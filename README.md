# FlowerShop: онлайн-магазин цветов

Это сайт сети магазинов FlowerShop. **Функционал включает**:

- Заказ букетов с оплатой онлайн через Ю.Касса;
- Опросник для определения идеально подходящего букета на основе бюджета и повода для подарка;
- Заказ консультации флориста с учетом ответов на опросник, если он был пройден;
- Уведомление флористов и курьеров о поступивших заказах;
- Сбор статистики заказов в админ-панели.

## Установка и запуск

Скачайте код:

```shell
git clone https://github.com/redkrayn/project_prime_flower_shop.git
```
Для работы сайта потребуется Python версии не ниже 3.12.3. Установите виртуальное окружение, а затем - зависимости:

```shell
python -m venv .venv
pip install -r requirements.txt
```
Создайте в корне проекта файл `.env` и добавьте в него переменные окружения (можно скопировать из `.env.exaple`):

- `DEBUG` - дебаг-режим (`True` / `False`); 
- `SECRET_KEY` - секретный ключ Django, должен быть длинным и уникальным;
- `ALLOWED_HOSTS` - список разрешенных хостов; для локального запуска достаточно указать `127.0.0.1`
- `CSRF_TRUSTED_ORIGINS` — список доверенных источников для CSRF (например, https://example.com);
- `WEBHOOK_URL` — базовый URL для формирования return_url в YooKassa и других вебхуков;
- `DB_NAME` - название базы данных SQLite;
- `TELEGRAM_BOT_TOKEN` - токен бота в Telegram, можно получить у [BotFather](https://telegram.me/BotFather);
- `TELEGRAM_DEFAULT_CHAT_ID` - Chat ID пользователя, который будет получать сообщения, если их не удалось отправить курьеру / флористу;
- `YOOKASSA_SHOP_ID`- ID магазина на YooKassa;
- `YOOKASSA_SECRET_KEY` - токен для YooKassa - его и ID магазина можно получить в кабинете разработчика (см. [документацию](https://yookassa.ru/developers)).

Далее следует создать и применить первую миграцию:
```shell
python manage.py makemigrations
python manage.py migrate
```
Если вы тестируете сайт, и вам необходимы данные товаров, вы можете воспользоваться фикстурами:

```shell
python manage.py loaddata bouquets.json
```

Также создайте суперпользователя, чтобы иметь доступ в админ-панель: введите нижеуказанную команду и следуйте инструкциям:
```shell
python manage.py createsuperuser
```
Наконец, вы можете запустить сайт локально, он будет доступен по ссылке http://127.0.0.1:8000/:
```shell
python manage.py runserver
```

## Особенности работы уведомлений в Telegram

Сайт умеет автоматически уведомлять флориста либо курьера о заказах и запросах на консультации. Вместе с тем, особенности Telegram не позволяют боту отправить сообщение пользователю, который с ним не взаимодействовал.

Чтобы уведомления работали корректно, сотрудник должен отправить `/start` боту. Бот не ответит, но после этого сотрудник сможет получать уведомления о новых заказах / заявках на консультации. Заказы будут передаваться наименее загруженным сотрудникам.

Если скрипт не сможет "достучаться" до нужного специалиста, сообщение о заказе / заявке на консультацию будет отправлено пользователю, чей ID будет указан в переменной окружения `TELEGRAM_DEFAULT_CHAT_ID`.

## Цели проекта 

Код написан в учебных целях — для курса по Python и веб-разработке на сайте [Devman](https://dvmn.org).